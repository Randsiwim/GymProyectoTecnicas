@using proyectoGymBlazor.Model
@using proyectoGymBlazor.Views.Components.Pages


<h3>Gestión de Inventario</h3>

<table class="table">
    <thead>
        <tr>
            <th>Nombre</th>
            <th>Fecha de Adquisición</th>
            <th>Vida Útil (meses)</th>
            <th>Estado</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var equipo in listaInventario)
        {
            <tr>
                <td>@equipo.Nombre</td>
                <td>@equipo.FechaAdquisicion.ToString("dd/MM/yyyy")</td>
                <td>@equipo.VidaUtilMeses</td>
                <td>@equipo.Estado</td>
                <td>
                    <button class="btn btn-primary" @onclick="() => EditarEquipo(equipo)">Editar</button>
                    <button class="btn btn-danger" @onclick="() => EliminarEquipo(equipo.EqupoId)">Eliminar</button>
                </td>
            </tr>
        }
    </tbody>
</table>

<button class="btn btn-success" @onclick="NuevoEquipo">Nuevo Equipo</button>

@if (mostrarFormulario)
{
    <div class="mt-3">
        <h4>@(equipoSeleccionado.EqupoId == 0 ? "Nuevo Equipo" : "Editar Equipo")</h4>
        <form>
            <div class="form-group">
                <label>Nombre</label>
                <input class="form-control" @bind="equipoSeleccionado.Nombre" />
            </div>
            <div class="form-group">
                <label>Fecha de Adquisición</label>
                <input type="date" class="form-control" @bind="equipoSeleccionado.FechaAdquisicion" />
            </div>
            <div class="form-group">
                <label>Vida Útil (meses)</label>
                <input type="number" class="form-control" @bind="equipoSeleccionado.VidaUtilMeses" />
            </div>
            <div class="form-group">
                <label>Estado</label>
                <select class="form-control" @bind="equipoSeleccionado.Estado">
                    <option>Disponible</option>
                    <option>En uso</option>
                    <option>En mantenimiento</option>
                </select>
            </div>
            <button class="btn btn-primary" @onclick="GuardarEquipo">Guardar</button>
            <button class="btn btn-secondary" @onclick="Cancelar">Cancelar</button>
        </form>
    </div>
}

@code {
    private List<proyectoGymBlazor.Model.Inventario> listaInventario = new();
    private proyectoGymBlazor.Model.Inventario equipoSeleccionado = new();
    private bool mostrarFormulario = false;

    protected override async Task OnInitializedAsync()
    {
        listaInventario = await InventarioService.GetInventarioAsync();
    }

    private void NuevoEquipo()
    {
        equipoSeleccionado = new proyectoGymBlazor.Model.Inventario();
        mostrarFormulario = true;
    }

    private void EditarEquipo(proyectoGymBlazor.Model.Inventario equipo)
    {
        equipoSeleccionado = equipo;
        mostrarFormulario = true;
    }

    private async Task GuardarEquipo()
    {
        if (equipoSeleccionado.EqupoId == 0)
        {
            await InventarioService.AddInventarioAsync(equipoSeleccionado);
        }
        else
        {
            await InventarioService.UpdateInventarioAsync(equipoSeleccionado);
        }

        listaInventario = await InventarioService.GetInventarioAsync();
        mostrarFormulario = false;
    }

    private async Task EliminarEquipo(int equipoId)
    {
        await InventarioService.DeleteInventarioAsync(equipoId);
        listaInventario = await InventarioService.GetInventarioAsync();
    }

    private void Cancelar()
    {
        mostrarFormulario = false;
    }
}
